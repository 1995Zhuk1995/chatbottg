# Вопросно-ответная диалоговая система (чатбот)

## Краткое описание

Мы разрабатываем набор инструментов, позволяющих организовывать диалоговые сессии
пользователя примерно такого вида:

```
B:> Привет, буду рад поговорить
H:> Как тебя зовут?
B:> кеша
B:> А как тебя зовут?
H:> Меня зовут Илья.
B:> Приятно познакомиться.
H:> Сколько будет 2 плюс 2?
B:> 4
H:> Меня как зовут?
B:> илья
H:> Сколько сейчас времени?
B:> 17 часов 47 минут
```

В этом примере реплики чатбота отмечены символами B:>, а реплики человека - символами H:>.

Основные особенности чатбота:

1) Новая информация (факты), сообщаемые пользователем, могут немедленно добавляться
в базу знаний и использоваться в последующих ответах наряду с остальными фактами. Именно так
в базу знаний бота попадает имя собеседника, которое он сообщает. Переобучение моделей
при этом не требуется.

2) Сессионность: сообщаемые пользователем факты сохраняются в отдельном разделе
базы знаний, привязанном к пользователю, так что сессии для разных пользователей
могут оперировать противоречащей или конфиденциальной информацией.

3) Ориентированность на клиент-серверный механизм; способ доставки сообщений отвязан от
ядра системы и может быть реализован в виде текстовой консоли, бота для мессенджера,
браузерного клиента для веб-сервиса и т.д.

4) Ответы чатбота не программируются скриптами или аналогичными средствами, а генерируются
обучаемыми моделями. В необходимых случаях используются нейросетевые deep learning модели,
а также классические NLP алгоритмы.

Благодаря использованию [посимвольных встраиваний для слов](./PyModels/trainers/README.wordchar2vector.md)
чатбот можно обучить отвечать даже на вопросы, относящиеся к символьному представлению слов:

```
B:> Привет, буду рад пообщаться
H:> сколько букв в слове мама?
B:> 4
```

В более широком смысле посимвольные встраивания для слов позволяют боту лучше учитывать
некоторые лексические особенности русского языка, в частности - однокоренные слова.

Специальная модель интерпретации ответов собеседника позволяет чатботу понимать неполные реплики,
опираясь на контекст беседы, и далее учитывать их как обычные факты:

```
B:> Здравствуй
H:> как тебя зовут?
B:> кеша
B:> А как тебя зовут?
H:> илья
B:> Приятно познакомиться.
H:> как меня зовут?
B:> илья
```

В данном примере чатбот задает вопрос "А как тебя зовут", рассчитывая заполнить пробел в своей базе
знаний. Собеседник сообщает свое имя, и его ответ интерпретируется как "Меня зовут Илья".
Эта реплика рассматривается как полноценный факт и запоминается в базе знаний, что видно
на последних двух репликах диалога, где собеседник спрашивает у бота свое имя и получает его.

## Консольный фронтенд для бота

Реализован в файле [console_chatbot.py](https://github.com/Koziev/chatbot/blob/master/PyModels/console_chatbot.py).
Запуск под Linux выполняется скриптом scripts/console_bot.sh

![Console frontend for chatbot](chatbot-console.PNG)

## Чатбот для Telegram

Реализован в файле [test_telegram_bot.py](https://github.com/Koziev/chatbot/blob/master/PyModels/bot/test_telegram_bot.py)

![Telegram frontend for chatbot](chatbot-telegram.png)

## Отладочная консоль

Для упрощения процесс проверки качества движка бота и отдельных моделей имеется
консольная утилита, позволяющая интерактивно задавать несколько предпосылок (от 0 до 3)
и вопрос, вызывающая модели вывода ответа и печатающая результат в консоль. В этом
процессе не участвуют такие части чатбота, как скриптование, подбор реплик для
поддержания разговора и база знаний, что облегчает отладку.

Для запуска отладочной консоли есть скрипт scripts/console_answer_builder.sh

## Технические подробности реализации

Описание тренировки и использования модели посимвольного встраивания слов
смотрите на [отдельной странице](./PyModels/trainers/README.wordchar2vector.md).

Также доступно [описание модели для определения релевантности факта и вопроса](README.relevance.md).
